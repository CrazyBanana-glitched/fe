{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/User/Downloads/db__-main/db__-main/octave-drift-detection/src/app/mode3/page.tsx"],"sourcesContent":["'use client'\nimport { useEffect, useState } from 'react'\nimport 'chartjs-chart-matrix'\nimport Head from 'next/head'\nimport D3ConfusionMatrix from '../../components/D3ConfusionMatrix'\n\ninterface KPI {\n  rowKey: string\n  value: string\n  status?: string\n}\n\ninterface ErrorData {\n  predicted: string\n  actual: string\n  timePeriod: string\n  meanPrediction: number\n  error: number\n  exceedsThreshold: boolean\n  yTrue?: number\n  yPred?: number\n  percentageError?: number\n}\n\ninterface ConfusionMatrixData {\n  reference: {\n    matrix: number[][]\n    labels: string[]\n    precision: number\n    recall: number\n    f1: number\n    accuracy: number\n  }\n  current: {\n    matrix: number[][]\n    labels: string[]\n    precision: number\n    recall: number\n    f1: number\n    accuracy: number\n  }\n}\n\nexport default function Mode3Page() {\n  const [businessUnit, setBusinessUnit] = useState('CCS')\n  const [useCase, setUseCase] = useState('CC-Di')\n  const [kpis, setKpis] = useState<KPI[]>([])\n  const [errors, setErrors] = useState<ErrorData[]>([])\n  const [confusionMatrix, setConfusionMatrix] = useState<ConfusionMatrixData>({\n    reference: {\n      matrix: [[0, 0], [0, 0]],\n      labels: ['Class A', 'Class B'],\n      precision: 0,\n      recall: 0,\n      f1: 0,\n      accuracy: 0\n    },\n    current: {\n      matrix: [[0, 0], [0, 0]],\n      labels: ['Class A', 'Class B'],\n      precision: 0,\n      recall: 0,\n      f1: 0,\n      accuracy: 0\n    }\n  })\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    const initData = async () => {\n      try {\n        const savedBusinessUnit = localStorage.getItem('businessUnit')\n        const savedUseCase = localStorage.getItem('useCase')\n        if (savedBusinessUnit) setBusinessUnit(savedBusinessUnit)\n        if (savedUseCase) setUseCase(savedUseCase)\n\n        const apiBase = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:5000';\n        const [metricsRes, errorsRes] = await Promise.all([\n          fetch(`${apiBase}/api/metrics?mode=3`),\n          fetch(`${apiBase}/api/errors`)\n        ]);\n\n        if (!metricsRes.ok || !errorsRes.ok) {\n          throw new Error(`API request failed: ${metricsRes.status} ${errorsRes.status}`);\n        }\n\n        const metricsData = await metricsRes.json();\n        const errorsData = await errorsRes.json();\n\n        // Normalize KPIs data format\n        const normalizedKpis = (metricsData.kpis || Object.entries(metricsData).map(([rowKey, value]) => ({\n          rowKey,\n          value: String(value),\n          status: metricsData.status\n        }))).filter((k: any) => k.rowKey && k.value);\n\n        // Normalize errors data format\n        const normalizedErrors = (errorsData.tableData || errorsData || []).map((e: any) => ({\n          predicted: e.predicted || e.pred || '',\n          actual: e.actual || e.act || '',\n          timePeriod: e.timePeriod || e.date || '',\n          meanPrediction: Number(e.meanPrediction || e.meanPred || 0),\n          error: Number(e.error || e.err || 0),\n          exceedsThreshold: Boolean(e.exceedsThreshold || e.exceedsThresh),\n          ...(e.yTrue !== undefined && { yTrue: Number(e.yTrue) }),\n          ...(e.yPred !== undefined && { yPred: Number(e.yPred) }),\n          ...(e.percentageError !== undefined && { percentageError: Number(e.percentageError) })\n        })).filter((e: any) => e.predicted && e.actual);\n\n        setKpis(normalizedKpis);\n        setErrors(normalizedErrors);\n\n        // Helper function to get numeric value from KPIs\n        const getKpiNumberValue = (key: string): number => {\n          const kpi = normalizedKpis.find((k: any) => k.rowKey === key);\n          if (!kpi) return 0;\n          const num = Number(kpi.value);\n          return isNaN(num) ? 0 : num;\n        };\n\n        setConfusionMatrix({\n          reference: {\n            matrix: [\n              [getKpiNumberValue('refTrueA'), getKpiNumberValue('refFalseB')],\n              [getKpiNumberValue('refFalseA'), getKpiNumberValue('refTrueB')]\n            ],\n            labels: ['Class A', 'Class B'],\n            precision: getKpiNumberValue('refPrecision'),\n            recall: getKpiNumberValue('refRecall'),\n            f1: getKpiNumberValue('refF1'),\n            accuracy: getKpiNumberValue('refAccuracy')\n          },\n          current: {\n            matrix: [\n              [getKpiNumberValue('currTrueA'), getKpiNumberValue('currFalseB')],\n              [getKpiNumberValue('currFalseA'), getKpiNumberValue('currTrueB')]\n            ],\n            labels: ['Class A', 'Class B'],\n            precision: getKpiNumberValue('currPrecision'),\n            recall: getKpiNumberValue('currRecall'),\n            f1: getKpiNumberValue('currF1'),\n            accuracy: getKpiNumberValue('currAccuracy')\n          }\n        });\n      } catch (error) {\n        console.error('Error loading data:', error)\n      } finally {\n        setLoading(false)\n      }\n    }\n    initData()\n  }, [])\n\n  // ... rest of the component code remains unchanged ...\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}