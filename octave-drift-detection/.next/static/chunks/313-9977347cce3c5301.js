"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[313],{313:(r,e,t)=>{t.d(e,{GS:()=>u,Vc:()=>n,k$:()=>l,pL:()=>c,sA:()=>i,uu:()=>s});let o="http://localhost:5000/api";async function a(r){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;try{let t=await fetch(r,e);if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return t}catch(o){if(t<=0)throw o;return console.warn("Retrying ".concat(r," (").concat(3-t+1,"/").concat(3,")")),await new Promise(r=>setTimeout(r,1e3)),a(r,e,t-1)}}async function s(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;try{let e=await a("".concat(o,"/metrics/1"));console.log("API response status:",e.status),console.log("API response headers:",Object.fromEntries(e.headers.entries()));let t=await e.text();console.log("Raw API response:",t),console.log("Response length:",t.length);try{let o;let a=t.trim(),n=null;for(let r of[/^[A-Z0-9]{5,8}$/i,/^"[A-Z0-9]{5,8}"$/i,/(?:code|error)[":\s]+([A-Z0-9]{5,8})/i,/(?:error|code)[":\s]+([A-Z0-9]{5,8})/i]){let e=a.match(r);if(e){n=e[0].replace(/["{}[\]]/g,"");break}}if(n){let o={code:n,status:e.status,headers:Object.fromEntries(e.headers.entries()),url:e.url,timestamp:new Date().toISOString(),rawResponse:t,retryAttempt:3-r+1};if(console.error("Backend error detected:",o),r>0)return console.warn("Retrying due to backend error code (".concat(a,")...")),await new Promise(r=>setTimeout(r,1e3)),s(r-1);throw Error("Backend service temporarily unavailable (code: ".concat(a,")"))}if(!(a.startsWith("{")||a.startsWith("[")))throw console.error("Unexpected non-JSON response:",{response:a,status:e.status,headers:Object.fromEntries(e.headers.entries())}),Error("Unexpected API response format: ".concat(a.substring(0,20),"..."));try{try{o=JSON.parse(a)}catch(c){let r=a.search(/[{\[]/);if(-1===r)throw Error("No JSON found in response");let e=r,t=0,s=!1,n=!1;for(let o=r;o<a.length;o++){let r=a[o];if(n){n=!1;continue}if("\\"===r){n=!0;continue}if('"'===r){s=!s;continue}if(!s&&(("{"===r||"["===r)&&t++,("}"===r||"]"===r)&&t--,0===t)){e=o;break}}let i=a.substring(r,e+1);o=JSON.parse(i)}}catch(t){let r=t instanceof Error?t:Error(String(t));throw console.error("JSON parse error:",{error:r.message,response:a,status:e.status,headers:Object.fromEntries(e.headers.entries()),stack:r.stack}),Error("API response parsing failed: ".concat(r.message))}if(Array.isArray(o)&&(o={kpis:o}),!o||!o.kpis)throw console.error("Invalid KPIs format:",{response:o,status:e.status,headers:Object.fromEntries(e.headers.entries())}),Error("Invalid KPIs response format - missing kpis array");if(!Array.isArray(o.kpis))throw console.error("KPIs is not an array:",o.kpis),Error("Invalid KPIs array format");let i=o.kpis.map(r=>{if(!r.rowKey||!r.value)throw console.error("Invalid KPI format:",r),Error("Missing required KPI fields");return"status"===r.rowKey?{rowKey:"Status",value:r.value,status:r.value}:{rowKey:r.rowKey,value:r.value,status:"Normal"}});return console.log("Processed KPIs:",i),i}catch(r){throw console.error("JSON parse error:",r,"on text:",t),Error("Failed to parse API response")}}catch(r){throw console.error("Failed to fetch mode1 KPIs:",r),Error("Failed to fetch KPIs. Please try again later.")}}async function n(r){try{let e;let t=r?"".concat(o,"/metrics/2/").concat(r):"".concat(o,"/metrics/2"),s=await a(t),n=await s.text();if(!s.ok)return console.warn("API returned non-OK status, using mock data"),d();try{e=JSON.parse(n)}catch(r){throw console.error("Failed to parse API response:",r),Error("Invalid API response format")}let i=Array.isArray(e)?e:(null==e?void 0:e.kpis)||[];if(0===i.length)return console.warn("Empty KPIs array received, using mock data"),d();return i.map(r=>{if(!r.rowKey||void 0===r.value)throw console.warn("Invalid KPI format:",r),Error("Invalid KPI response format");return{rowKey:r.rowKey,value:String(r.value),status:r.status||"Normal",businessUnit:r.businessUnit,useCase:r.useCase,...r.id&&{id:r.id}}})}catch(r){if(console.error("Failed to fetch mode2 KPIs:",r),r instanceof Error)throw Error("Failed to fetch KPIs: ".concat(r.message));throw Error("Failed to fetch KPIs. Please try again later.")}}async function i(){try{let r=await a("".concat(o,"/metrics/3")),e=await r.json();if(!Array.isArray(e))throw Error("Invalid KPIs response format");return e}catch(r){throw console.error("Failed to fetch mode3 KPIs:",r),Error("Failed to fetch KPIs. Please try again later.")}}async function c(){try{let r=await a("".concat(o,"/xai/1")),e=await r.json();if("string"==typeof e)return e;if(null==e?void 0:e.text)return e.text;throw Error("Invalid XAI response format")}catch(r){throw console.error("Failed to fetch mode1 XAI data:",r),Error("Failed to fetch XAI data. Please try again later.")}}async function l(r){try{let e=r?"".concat(o,"/xai/2/").concat(r):"".concat(o,"/xai/2"),t=await a(e),s=await t.json();if(!t.ok)throw Error("API returned status ".concat(t.status));if("string"==typeof s)return s;if(null==s?void 0:s.text)return s.text;if(null==s?void 0:s.explanation)return s.explanation;throw Error("Invalid XAI response format")}catch(r){if(console.error("Failed to fetch mode2 XAI data:",r),r instanceof Error)throw Error("Failed to fetch XAI data: ".concat(r.message));throw Error("Failed to fetch XAI data. Please try again later.")}}function d(){let r=new Date,e=["CCS","JMSL"],t={CCS:["CC-Di","CC-MT"],JMSL:["JM-Ch"]},o=e[Math.floor(Math.random()*e.length)];return[{rowKey:"alertTime",value:new Date(r.getTime()-1728e5*Math.random()).toISOString(),status:"Normal",businessUnit:o,useCase:t[o][0]},{rowKey:"runtimeCount",value:Math.floor(300*Math.random()).toString(),status:"Normal",businessUnit:o,useCase:t[o][0]},{rowKey:"alertKeeper",value:"".concat(o," Admin"),status:"Normal",businessUnit:o,useCase:t[o][0]},{rowKey:"currentDrift1",value:Math.random().toFixed(2),status:Math.random()>.8?"Warning":"Normal",businessUnit:o,useCase:t[o][0]},{rowKey:"currentDrift2",value:Math.random().toFixed(2),status:Math.random()>.8?"Warning":"Normal",businessUnit:o,useCase:t[o][0]},{rowKey:"status",value:Math.random()>.9?"Error":Math.random()>.7?"Warning":"Normal",status:Math.random()>.9?"Error":Math.random()>.7?"Warning":"Normal",businessUnit:o,useCase:t[o][0]},{rowKey:"businessUnit",value:o,status:"Normal",businessUnit:o,useCase:t[o][0]},{rowKey:"useCase",value:t[o][0],status:"Normal",businessUnit:o,useCase:t[o][0]}]}async function u(){try{let r;let e=await a("".concat(o,"/errors")),t=await e.text();if(!e.ok)throw Error("API returned status ".concat(e.status));try{r=JSON.parse(t)}catch(r){throw console.error("Failed to parse errors response:",r,"Response:",t),Error("Invalid errors response format")}if(!r)throw Error("Empty errors response");let s=Array.isArray(r)?{plotData:[],tableData:r}:r,n=(s.plotData||[]).map(r=>{let e=r.timePeriod||new Date().toISOString(),t="number"==typeof r.error?r.error:0;return{x:e,y:t,exceedsThreshold:!!r.exceedsThreshold}}),i=(s.tableData||[]).map(r=>{let e=r.timePeriod||new Date().toISOString(),t="number"==typeof r.meanPrediction?r.meanPrediction:0,o="number"==typeof r.error?r.error:0,a="number"==typeof r.percentageError?r.percentageError:0;return{id:r.id||"",timePeriod:e,meanPrediction:t,error:o,percentageError:a,status:r.exceedsThreshold?"Alert":"Normal"}});if(0===n.length&&0===i.length){console.warn("No error data received, generating sample data");let r=Array.from({length:10},(r,e)=>({id:"MISSING_BACKEND_ID_".concat(e),timePeriod:new Date(Date.now()-864e5*e).toISOString(),meanPrediction:100*Math.random(),error:20*Math.random(),exceedsThreshold:Math.random()>.7,percentageError:30*Math.random()}));return{plotData:r.map(r=>({x:r.timePeriod||new Date().toISOString(),y:r.error||0,exceedsThreshold:!!r.exceedsThreshold})),tableData:r.map(r=>({id:r.id||"",timePeriod:r.timePeriod||new Date().toISOString(),meanPrediction:r.meanPrediction||0,error:r.error||0,percentageError:r.percentageError||0,status:r.exceedsThreshold?"Alert":"Normal"}))}}return{plotData:n,tableData:i}}catch(e){console.error("Failed to fetch errors:",e);let r=Array.from({length:10},(r,e)=>({id:"MISSING_BACKEND_ID_".concat(e),timePeriod:new Date(Date.now()-864e5*e).toISOString(),meanPrediction:100*Math.random(),error:20*Math.random(),exceedsThreshold:Math.random()>.7,percentageError:30*Math.random()}));return{plotData:r.map(r=>({x:r.timePeriod||new Date().toISOString(),y:r.error||0,exceedsThreshold:!!r.exceedsThreshold})),tableData:r.map(r=>({id:r.id||"",timePeriod:r.timePeriod||new Date().toISOString(),meanPrediction:r.meanPrediction||0,error:r.error||0,percentageError:r.percentageError||0,status:r.exceedsThreshold?"Alert":"Normal"}))}}}}}]);