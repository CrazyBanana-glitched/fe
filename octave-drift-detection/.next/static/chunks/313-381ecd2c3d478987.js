"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[313],{313:(e,r,t)=>{t.d(r,{GS:()=>d,Vc:()=>n,k$:()=>c,pL:()=>i,uu:()=>s});let o="http://localhost:5000/api";async function a(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;try{let t=await fetch(e,r);if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return t}catch(o){if(t<=0)throw o;return console.warn("Retrying ".concat(e," (").concat(3-t+1,"/").concat(3,")")),await new Promise(e=>setTimeout(e,1e3)),a(e,r,t-1)}}async function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;try{let r=await a("".concat(o,"/metrics/1"));console.log("API response status:",r.status),console.log("API response headers:",Object.fromEntries(r.headers.entries()));let t=await r.text();console.log("Raw API response:",t),console.log("Response length:",t.length);try{let o;let a=t.trim(),n=null;for(let e of[/^[A-Z0-9]{5,8}$/i,/^"[A-Z0-9]{5,8}"$/i,/(?:code|error)[":\s]+([A-Z0-9]{5,8})/i,/(?:error|code)[":\s]+([A-Z0-9]{5,8})/i]){let r=a.match(e);if(r){n=r[0].replace(/["{}[\]]/g,"");break}}if(n){let o={code:n,status:r.status,headers:Object.fromEntries(r.headers.entries()),url:r.url,timestamp:new Date().toISOString(),rawResponse:t,retryAttempt:3-e+1};if(console.error("Backend error detected:",o),e>0)return console.warn("Retrying due to backend error code (".concat(a,")...")),await new Promise(e=>setTimeout(e,1e3)),s(e-1);throw Error("Backend service temporarily unavailable (code: ".concat(a,")"))}if(!(a.startsWith("{")||a.startsWith("[")))throw console.error("Unexpected non-JSON response:",{response:a,status:r.status,headers:Object.fromEntries(r.headers.entries())}),Error("Unexpected API response format: ".concat(a.substring(0,20),"..."));try{try{o=JSON.parse(a)}catch(c){let e=a.search(/[{\[]/);if(-1===e)throw Error("No JSON found in response");let r=e,t=0,s=!1,n=!1;for(let o=e;o<a.length;o++){let e=a[o];if(n){n=!1;continue}if("\\"===e){n=!0;continue}if('"'===e){s=!s;continue}if(!s&&(("{"===e||"["===e)&&t++,("}"===e||"]"===e)&&t--,0===t)){r=o;break}}let i=a.substring(e,r+1);o=JSON.parse(i)}}catch(t){let e=t instanceof Error?t:Error(String(t));throw console.error("JSON parse error:",{error:e.message,response:a,status:r.status,headers:Object.fromEntries(r.headers.entries()),stack:e.stack}),Error("API response parsing failed: ".concat(e.message))}if(Array.isArray(o)&&(o={kpis:o}),!o||!o.kpis)throw console.error("Invalid KPIs format:",{response:o,status:r.status,headers:Object.fromEntries(r.headers.entries())}),Error("Invalid KPIs response format - missing kpis array");if(!Array.isArray(o.kpis))throw console.error("KPIs is not an array:",o.kpis),Error("Invalid KPIs array format");let i=o.kpis.map(e=>{if(!e.rowKey||!e.value)throw console.error("Invalid KPI format:",e),Error("Missing required KPI fields");return"status"===e.rowKey?{rowKey:"Status",value:e.value,status:e.value}:{rowKey:e.rowKey,value:e.value,status:"Normal"}});return console.log("Processed KPIs:",i),i}catch(e){throw console.error("JSON parse error:",e,"on text:",t),Error("Failed to parse API response")}}catch(e){throw console.error("Failed to fetch mode1 KPIs:",e),Error("Failed to fetch KPIs. Please try again later.")}}async function n(e){try{let r;let t=e?"".concat(o,"/metrics/2/").concat(e):"".concat(o,"/metrics/2"),s=await a(t),n=await s.text();if(!s.ok)return console.warn("API returned non-OK status, using mock data"),l();try{r=JSON.parse(n)}catch(e){throw console.error("Failed to parse API response:",e),Error("Invalid API response format")}let i=Array.isArray(r)?r:(null==r?void 0:r.kpis)||[];if(0===i.length)return console.warn("Empty KPIs array received, using mock data"),l();return i.map(e=>{if(!e.rowKey||void 0===e.value)throw console.warn("Invalid KPI format:",e),Error("Invalid KPI response format");return{rowKey:e.rowKey,value:String(e.value),status:e.status||"Normal",businessUnit:e.businessUnit,useCase:e.useCase,...e.id&&{id:e.id}}})}catch(e){if(console.error("Failed to fetch mode2 KPIs:",e),e instanceof Error)throw Error("Failed to fetch KPIs: ".concat(e.message));throw Error("Failed to fetch KPIs. Please try again later.")}}async function i(){try{let e=await a("".concat(o,"/xai/1")),r=await e.json();if("string"==typeof r)return r;if(null==r?void 0:r.text)return r.text;throw Error("Invalid XAI response format")}catch(e){throw console.error("Failed to fetch mode1 XAI data:",e),Error("Failed to fetch XAI data. Please try again later.")}}async function c(e){try{let r=e?"".concat(o,"/xai/2/").concat(e):"".concat(o,"/xai/2"),t=await a(r),s=await t.json();if(!t.ok)throw Error("API returned status ".concat(t.status));if("string"==typeof s)return s;if(null==s?void 0:s.text)return s.text;if(null==s?void 0:s.explanation)return s.explanation;throw Error("Invalid XAI response format")}catch(e){if(console.error("Failed to fetch mode2 XAI data:",e),e instanceof Error)throw Error("Failed to fetch XAI data: ".concat(e.message));throw Error("Failed to fetch XAI data. Please try again later.")}}function l(){let e=new Date,r=["CCS","JMSL"],t={CCS:["CC-Di","CC-MT"],JMSL:["JM-Ch"]},o=r[Math.floor(Math.random()*r.length)];return[{rowKey:"alertTime",value:new Date(e.getTime()-1728e5*Math.random()).toISOString(),status:"Normal",businessUnit:o,useCase:t[o][0]},{rowKey:"runtimeCount",value:Math.floor(300*Math.random()).toString(),status:"Normal",businessUnit:o,useCase:t[o][0]},{rowKey:"alertKeeper",value:"".concat(o," Admin"),status:"Normal",businessUnit:o,useCase:t[o][0]},{rowKey:"currentDrift1",value:Math.random().toFixed(2),status:Math.random()>.8?"Warning":"Normal",businessUnit:o,useCase:t[o][0]},{rowKey:"currentDrift2",value:Math.random().toFixed(2),status:Math.random()>.8?"Warning":"Normal",businessUnit:o,useCase:t[o][0]},{rowKey:"status",value:Math.random()>.9?"Error":Math.random()>.7?"Warning":"Normal",status:Math.random()>.9?"Error":Math.random()>.7?"Warning":"Normal",businessUnit:o,useCase:t[o][0]},{rowKey:"businessUnit",value:o,status:"Normal",businessUnit:o,useCase:t[o][0]},{rowKey:"useCase",value:t[o][0],status:"Normal",businessUnit:o,useCase:t[o][0]}]}async function d(){try{let e;let r=await a("".concat(o,"/errors")),t=await r.text();if(!r.ok)throw Error("API returned status ".concat(r.status));try{e=JSON.parse(t)}catch(e){throw console.error("Failed to parse errors response:",e,"Response:",t),Error("Invalid errors response format")}if(!e)throw Error("Empty errors response");let s=Array.isArray(e)?{plotData:[],tableData:e}:e,n=(s.plotData||[]).map(e=>{let r=e.timePeriod||new Date().toISOString(),t="number"==typeof e.error?e.error:0;return{x:r,y:t,exceedsThreshold:!!e.exceedsThreshold}}),i=(s.tableData||[]).map(e=>{let r=e.timePeriod||new Date().toISOString(),t="number"==typeof e.meanPrediction?e.meanPrediction:0,o="number"==typeof e.error?e.error:0,a="number"==typeof e.percentageError?e.percentageError:0;return{id:e.id||"",timePeriod:r,meanPrediction:t,error:o,percentageError:a,status:e.exceedsThreshold?"Alert":"Normal"}});if(0===n.length&&0===i.length){console.warn("No error data received, generating sample data");let e=Array.from({length:10},(e,r)=>({id:"MISSING_BACKEND_ID_".concat(r),timePeriod:new Date(Date.now()-864e5*r).toISOString(),meanPrediction:100*Math.random(),error:20*Math.random(),exceedsThreshold:Math.random()>.7,percentageError:30*Math.random()}));return{plotData:e.map(e=>({x:e.timePeriod||new Date().toISOString(),y:e.error||0,exceedsThreshold:!!e.exceedsThreshold})),tableData:e.map(e=>({id:e.id||"",timePeriod:e.timePeriod||new Date().toISOString(),meanPrediction:e.meanPrediction||0,error:e.error||0,percentageError:e.percentageError||0,status:e.exceedsThreshold?"Alert":"Normal"}))}}return{plotData:n,tableData:i}}catch(r){console.error("Failed to fetch errors:",r);let e=Array.from({length:10},(e,r)=>({id:"MISSING_BACKEND_ID_".concat(r),timePeriod:new Date(Date.now()-864e5*r).toISOString(),meanPrediction:100*Math.random(),error:20*Math.random(),exceedsThreshold:Math.random()>.7,percentageError:30*Math.random()}));return{plotData:e.map(e=>({x:e.timePeriod||new Date().toISOString(),y:e.error||0,exceedsThreshold:!!e.exceedsThreshold})),tableData:e.map(e=>({id:e.id||"",timePeriod:e.timePeriod||new Date().toISOString(),meanPrediction:e.meanPrediction||0,error:e.error||0,percentageError:e.percentageError||0,status:e.exceedsThreshold?"Alert":"Normal"}))}}}}}]);